<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scotland Yard</title>
    <link rel="stylesheet" href="/styles/game.css" />
  </head>

  <body>
    {% comment %} <svg id="textsvg">
      <g id="playerbody">
        <path
          id="playerheadpath"
          stroke-width="4"
          stroke="#7A6AC0"
          fill="#0000"
        />
        <path
          id="playerbodypath"
          stroke-width="4"
          stroke="#7A6AC0"
          fill="#0000"
          d="M 100 100 L 125 50 L 150 100 L 112 100"
        />
      </g>
    </svg> {% endcomment %}
  
    <code id = "gameLog">
    </code>

    <br>
    <input type="text" id="ws-command" />
    <button id="send" onclick="wsSend()">send</button>

    <script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
    <script src="/js/anime.min.js"></script>
    <script>
      document
        .getElementById("playerheadpath")
        .setAttribute("d", circlePath(125, 30, 18));

      opentype.load("/styles/fonts/Comfortaa.ttf", function (err, font) {
        if (err) {
          console.log("Font could not be loaded: " + err);
        } else {
          const path = font.getPath("scotlandyard", 0, 150, 72);
          // document.getElementById("textpath").setAttribute("d", path.toPathData());
        }
      });

      // let t = anime.timeline()
      anime({
        targets: "#playerbody path",
        strokeDashoffset: [anime.setDashoffset, 0],
        easing: "easeInOutSine",
        delay: function (el, i, n) {
          return (n - i - 1) * 200;
        },
        duration: 1000,
      });
    </script>

    <script>
      const PLAYER_ID = '{{ player_id }}';
      const GAME_ID = '{{ game_id }}';
      const NAME = '{{ name }}';
      let color = '{{ color }}';
      const IS_HOST = {% if is_host %}true{% else %} false{% endif %};
    </script>

    <script>
      // TODO DEBUG ONLY remove this
      const socket = new WebSocket(
        `ws${location.protocol === "https:" ? "s" : ""}://${
          window.location.host
        }/ws/game/${GAME_ID}`
      );

      socket.onclose = function (event) {
        console.log("Socket closed");
      };

      socket.onopen = function (event) {
        console.log("Socket opened");
      };


      const prompt = document.getElementById("ws-command");
      prompt.addEventListener("keyup", (event) => {
        if(event.keyCode === 13){
          wsSend();
        }
      })
      let log = "";
      const logElement = document.getElementById("gameLog");

      function wsSend() {
        const command = prompt.value;
        socket.send(command);
        log += `<br><span style="color:blue">${command}</span>`;
        logElement.innerHTML = log;
      }

      socket.onmessage = (msg) => {
        console.log(msg);
        log += "<br>" + msg.data;
        logElement.innerHTML = log;
      }
        
    </script>
  </body>
</html>
